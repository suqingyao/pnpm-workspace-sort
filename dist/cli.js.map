{"version":3,"sources":["../src/cli.ts","../src/index.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport yaml from 'js-yaml';\nimport { sortWorkspaceData, WorkspaceData } from './index.js';\n\nconst DEFAULT_WORKSPACE_FILE = 'pnpm-workspace.yaml';\n\nfunction run() {\n  const args = process.argv.slice(2);\n  const targetFile = args[0] || DEFAULT_WORKSPACE_FILE;\n  const filePath = path.resolve(process.cwd(), targetFile);\n\n  if (!fs.existsSync(filePath)) {\n    console.error(`Error: ${targetFile} not found in current directory.`);\n    process.exit(1);\n  }\n\n  try {\n    const fileContent = fs.readFileSync(filePath, 'utf8');\n    const doc = yaml.load(fileContent) as WorkspaceData;\n\n    if (!doc) {\n      console.error('Error: Failed to parse YAML file or file is empty.');\n      process.exit(1);\n    }\n\n    const result = sortWorkspaceData(doc);\n\n    if (result.changed) {\n      result.changes.forEach(msg => console.log(msg));\n      \n      // Dump with reasonable options\n      const newYaml = yaml.dump(result.doc, {\n        indent: 2,\n        lineWidth: -1, // Don't wrap long lines\n        noRefs: true,\n        quotingType: '\"'\n      });\n      \n      fs.writeFileSync(filePath, newYaml, 'utf8');\n      console.log(`Successfully updated ${targetFile}`);\n    } else {\n      console.log('Already sorted. No changes made.');\n    }\n\n  } catch (e) {\n    console.error('Error processing YAML file:', e);\n    process.exit(1);\n  }\n}\n\nrun();\n","export const sortObject = (obj: any): any => {\n  if (!obj || typeof obj !== 'object' || Array.isArray(obj)) return obj;\n  return Object.keys(obj)\n    .sort((a, b) => a.localeCompare(b))\n    .reduce((acc: any, key) => {\n      acc[key] = obj[key];\n      return acc;\n    }, {});\n};\n\nexport interface WorkspaceData {\n  packages?: string[];\n  catalog?: Record<string, string>;\n  catalogs?: Record<string, Record<string, string>>;\n  [key: string]: any;\n}\n\nexport interface SortResult {\n  doc: WorkspaceData;\n  changed: boolean;\n  changes: string[];\n}\n\nexport function sortWorkspaceData(doc: WorkspaceData): SortResult {\n  let changed = false;\n  const changes: string[] = [];\n\n  // Sort packages\n  if (doc.packages && Array.isArray(doc.packages)) {\n    const original = JSON.stringify(doc.packages);\n    doc.packages.sort((a, b) => a.localeCompare(b));\n    if (JSON.stringify(doc.packages) !== original) {\n      changed = true;\n      changes.push('Sorted packages.');\n    }\n  }\n\n  // Sort catalog\n  if (doc.catalog && typeof doc.catalog === 'object') {\n    const original = JSON.stringify(doc.catalog);\n    doc.catalog = sortObject(doc.catalog);\n    if (JSON.stringify(doc.catalog) !== original) {\n      changed = true;\n      changes.push('Sorted catalog dependencies.');\n    }\n  }\n\n  // Sort catalogs (named catalogs)\n  if (doc.catalogs && typeof doc.catalogs === 'object') {\n    const sortedCatalogs: Record<string, Record<string, string>> = {};\n    \n    // Sort keys of catalogs (the catalog names)\n    const catalogNames = Object.keys(doc.catalogs).sort((a, b) => a.localeCompare(b));\n    \n    for (const name of catalogNames) {\n        const cat = doc.catalogs[name];\n        // Sort dependencies inside each catalog\n        sortedCatalogs[name] = sortObject(cat);\n    }\n\n    if (JSON.stringify(doc.catalogs) !== JSON.stringify(sortedCatalogs)) {\n        doc.catalogs = sortedCatalogs;\n        changed = true;\n        changes.push('Sorted named catalogs dependencies.');\n    }\n  }\n\n  return { doc, changed, changes };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,gBAAe;AACf,kBAAiB;AACjB,qBAAiB;;;ACJV,IAAM,aAAa,CAAC,QAAkB;AAC3C,MAAI,CAAC,OAAO,OAAO,QAAQ,YAAY,MAAM,QAAQ,GAAG,EAAG,QAAO;AAClE,SAAO,OAAO,KAAK,GAAG,EACnB,KAAK,CAAC,GAAG,MAAM,EAAE,cAAc,CAAC,CAAC,EACjC,OAAO,CAAC,KAAU,QAAQ;AACzB,QAAI,GAAG,IAAI,IAAI,GAAG;AAClB,WAAO;AAAA,EACT,GAAG,CAAC,CAAC;AACT;AAeO,SAAS,kBAAkB,KAAgC;AAChE,MAAI,UAAU;AACd,QAAM,UAAoB,CAAC;AAG3B,MAAI,IAAI,YAAY,MAAM,QAAQ,IAAI,QAAQ,GAAG;AAC/C,UAAM,WAAW,KAAK,UAAU,IAAI,QAAQ;AAC5C,QAAI,SAAS,KAAK,CAAC,GAAG,MAAM,EAAE,cAAc,CAAC,CAAC;AAC9C,QAAI,KAAK,UAAU,IAAI,QAAQ,MAAM,UAAU;AAC7C,gBAAU;AACV,cAAQ,KAAK,kBAAkB;AAAA,IACjC;AAAA,EACF;AAGA,MAAI,IAAI,WAAW,OAAO,IAAI,YAAY,UAAU;AAClD,UAAM,WAAW,KAAK,UAAU,IAAI,OAAO;AAC3C,QAAI,UAAU,WAAW,IAAI,OAAO;AACpC,QAAI,KAAK,UAAU,IAAI,OAAO,MAAM,UAAU;AAC5C,gBAAU;AACV,cAAQ,KAAK,8BAA8B;AAAA,IAC7C;AAAA,EACF;AAGA,MAAI,IAAI,YAAY,OAAO,IAAI,aAAa,UAAU;AACpD,UAAM,iBAAyD,CAAC;AAGhE,UAAM,eAAe,OAAO,KAAK,IAAI,QAAQ,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,cAAc,CAAC,CAAC;AAEhF,eAAW,QAAQ,cAAc;AAC7B,YAAM,MAAM,IAAI,SAAS,IAAI;AAE7B,qBAAe,IAAI,IAAI,WAAW,GAAG;AAAA,IACzC;AAEA,QAAI,KAAK,UAAU,IAAI,QAAQ,MAAM,KAAK,UAAU,cAAc,GAAG;AACjE,UAAI,WAAW;AACf,gBAAU;AACV,cAAQ,KAAK,qCAAqC;AAAA,IACtD;AAAA,EACF;AAEA,SAAO,EAAE,KAAK,SAAS,QAAQ;AACjC;;;AD7DA,IAAM,yBAAyB;AAE/B,SAAS,MAAM;AACb,QAAM,OAAO,QAAQ,KAAK,MAAM,CAAC;AACjC,QAAM,aAAa,KAAK,CAAC,KAAK;AAC9B,QAAM,WAAW,YAAAA,QAAK,QAAQ,QAAQ,IAAI,GAAG,UAAU;AAEvD,MAAI,CAAC,UAAAC,QAAG,WAAW,QAAQ,GAAG;AAC5B,YAAQ,MAAM,UAAU,UAAU,kCAAkC;AACpE,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,MAAI;AACF,UAAM,cAAc,UAAAA,QAAG,aAAa,UAAU,MAAM;AACpD,UAAM,MAAM,eAAAC,QAAK,KAAK,WAAW;AAEjC,QAAI,CAAC,KAAK;AACR,cAAQ,MAAM,oDAAoD;AAClE,cAAQ,KAAK,CAAC;AAAA,IAChB;AAEA,UAAM,SAAS,kBAAkB,GAAG;AAEpC,QAAI,OAAO,SAAS;AAClB,aAAO,QAAQ,QAAQ,SAAO,QAAQ,IAAI,GAAG,CAAC;AAG9C,YAAM,UAAU,eAAAA,QAAK,KAAK,OAAO,KAAK;AAAA,QACpC,QAAQ;AAAA,QACR,WAAW;AAAA;AAAA,QACX,QAAQ;AAAA,QACR,aAAa;AAAA,MACf,CAAC;AAED,gBAAAD,QAAG,cAAc,UAAU,SAAS,MAAM;AAC1C,cAAQ,IAAI,wBAAwB,UAAU,EAAE;AAAA,IAClD,OAAO;AACL,cAAQ,IAAI,kCAAkC;AAAA,IAChD;AAAA,EAEF,SAAS,GAAG;AACV,YAAQ,MAAM,+BAA+B,CAAC;AAC9C,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF;AAEA,IAAI;","names":["path","fs","yaml"]}